---
page_title: "visionone_cam_legacy_cleanup_custom_role Resource - visionone"
subcategory: "Azure"
description: |-
  Deletes legacy Custom Role Definition created by CAM Ver1 deployments. The resource automatically detects whether a legacy Custom Role exists before attempting cleanup. Also deletes all associated role assignments. Returns cleanup_status = "not_found" if no legacy resources exist.
---

# visionone_cam_legacy_cleanup_custom_role (Resource)

Deletes legacy Custom Role Definition created by CAM Ver1 deployments. The resource automatically detects whether a legacy Custom Role exists before attempting cleanup. Also deletes all associated role assignments. Returns `cleanup_status = "not_found"` if no legacy resources exist.

## Use Cases

- **Legacy to Ver2 Migration**: Clean up legacy Custom Role when migrating to Ver2 management group deployments
- **Role Assignment Cleanup**: Automatically removes all associated role assignments before deleting the Custom Role
- **Per-Subscription Cleanup**: Clean up Custom Roles across multiple subscriptions systematically
- **Graceful Handling**: Returns "not_found" status if no legacy resources exist (no errors)

## Behavior

- **`terraform apply`**: Detects and deletes legacy Custom Role if it exists, along with all associated role assignments
- **`terraform destroy`**: Removes resource from Terraform state only (Azure resources unchanged)
- **Built-In Detection**: Automatically detects whether legacy Custom Role exists before attempting cleanup
- **Cascading Deletion**: All role assignments using this Custom Role are deleted first, then the Custom Role itself
- **Graceful Handling**: If no legacy Custom Role exists, returns `cleanup_status = "not_found"` instead of erroring

## Example Usage

```terraform
# Delete legacy Custom Role from CAM Ver1 deployment
resource "visionone_cam_legacy_cleanup_custom_role" "example" {
  subscription_id = "12345678-1234-1234-1234-123456789012"
}
```

### Advanced Usage Examples

<details>
<summary>Multi-Subscription Cleanup</summary>

```terraform
# Multi-subscription legacy Custom Role cleanup
variable "subscription_ids" {
  type = list(string)
  default = [
    "12345678-1234-1234-1234-123456789012",
    "23456789-2345-2345-2345-234567890123",
  ]
}

locals {
  cleanup_subscription_ids = toset(var.subscription_ids)
}

# Deploy Ver2 CAM connector resources (not shown - see CAM connector examples)
# resource "visionone_cam_connector_azure" "subscriptions" {...}

# Cleanup legacy Custom Roles
resource "visionone_cam_legacy_cleanup_custom_role" "cleanup" {
  depends_on = [visionone_cam_connector_azure.subscriptions]

  for_each = local.cleanup_subscription_ids

  subscription_id = each.key
}

# Output cleanup results
output "custom_role_cleanup_summary" {
  value = {
    for k, v in visionone_cam_legacy_cleanup_custom_role.cleanup :
    k => {
      deleted            = v.deleted
      role_assignments   = v.role_assignments_count
      cleanup_status     = v.cleanup_status
      deletion_timestamp = v.deletion_timestamp
    }
  }
}
```

</details>

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `subscription_id` (String) Azure subscription ID containing the legacy Custom Role to delete

### Optional

- `custom_role_id` (String) Full Azure resource ID of the Custom Role for validation (optional). If provided, cleanup will fail if the detected Custom Role doesn't match this ID.

### Read-Only

- `cleanup_error` (String) Error message if cleanup failed
- `cleanup_status` (String) Status of cleanup operation: deleted, not_found, or failed
- `deleted` (Boolean) Whether the Custom Role was successfully deleted
- `deletion_timestamp` (String) Timestamp when deletion was performed (RFC3339 format)
- `id` (String) Unique identifier for this cleanup resource (subscription ID)
- `role_assignments_count` (Number) Number of role assignments that were deleted

## Important Notes

- **Built-In Detection**: Resource automatically detects whether legacy Custom Role exists before attempting cleanup
- **Role Assignment Deletion**: All role assignments using this Custom Role are automatically deleted before the Custom Role
- **Per-Subscription**: Each subscription has its own Custom Role that must be cleaned up separately
- **Validation**: Use the optional `custom_role_id` parameter to validate the correct resource is being deleted
- **Graceful Handling**: If no legacy Custom Role exists, `cleanup_status` will be "not_found" (not an error)
- **No Dry Run**: This resource always attempts cleanup when applied (gracefully handles non-existent resources)

## Cleanup Status Values

The `cleanup_status` field indicates what happened:

- **`deleted`** - Legacy Custom Role was found and successfully deleted (along with role assignments)
- **`not_found`** - No legacy Custom Role exists (nothing to clean up)
- **`failed`** - Cleanup operation encountered an error (check `cleanup_error` field for details)
- **`recreated`** - Legacy resource was recreated after previous cleanup (detected during refresh)

## Terraform Behavior

### terraform apply
Creates the cleanup resource in Terraform state, detects legacy Custom Role, and deletes it (including role assignments) if found.

### terraform destroy
Removes the cleanup resource from Terraform state. **Does NOT delete** the Azure Custom Role (cleanup only happens on apply, not destroy).

### terraform refresh
Re-checks if the Custom Role was recreated after cleanup. Updates `cleanup_status` to "recreated" if detected.

## Import

Legacy cleanup resources do not support import as they are cleanup operations rather than persistent Azure resources.
