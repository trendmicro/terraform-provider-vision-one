---
page_title: "visionone_cam_legacy_cleanup_app_registration Resource - visionone"
subcategory: "Azure"
description: |-
  Deletes legacy App Registration created by CAM Ver1 deployments. The resource automatically detects whether a legacy App Registration exists before attempting cleanup. Deleting the App Registration automatically cascades to delete the associated Service Principal and Federated Identity Credentials. Returns cleanup_status = "not_found" if no legacy resources exist.
---

# visionone_cam_legacy_cleanup_app_registration (Resource)

Deletes legacy App Registration created by CAM Ver1 deployments. The resource automatically detects whether a legacy App Registration exists before attempting cleanup. Deleting the App Registration automatically cascades to delete the associated Service Principal and Federated Identity Credentials. Returns `cleanup_status = "not_found"` if no legacy resources exist.

## Use Cases

- **Legacy to Ver2 Migration**: Clean up legacy App Registration when migrating to Ver2 management group with new App Registration
- **Cascading Cleanup**: Automatically removes associated Service Principal and Federated Identity Credentials
- **Primary Subscription Only**: Should only be used for the primary subscription that hosts the App Registration
- **Graceful Handling**: Returns "not_found" status if no legacy resources exist (no errors)

## Behavior

- **`terraform apply`**: Detects and deletes legacy App Registration if it exists
- **`terraform destroy`**: Removes resource from Terraform state only (Azure resources unchanged)
- **Built-In Detection**: Automatically detects whether legacy App Registration exists before attempting cleanup
- **Cascading Deletion**: Deleting App Registration automatically deletes Service Principal and Federated Identity Credentials
- **Graceful Handling**: If no legacy App Registration exists, returns `cleanup_status = "not_found"` instead of erroring

## Example Usage

```terraform
# Delete legacy App Registration from CAM Ver1 deployment
resource "visionone_cam_legacy_cleanup_app_registration" "example" {
  subscription_id = "12345678-1234-1234-1234-123456789012"
}
```

### Advanced Usage Examples

<details>
<summary>Conditional Cleanup (only when not reusing App Registration)</summary>

```terraform
# Complete Ver1 to Ver2 migration workflow with legacy cleanup
variable "primary_subscription_id" {
  type    = string
  default = "12345678-1234-1234-1234-123456789012"
}

variable "use_existing_app_registration" {
  type        = bool
  description = "Set to true if reusing existing App Registration for Ver2"
  default     = false
}

# Deploy Ver2 CAM connector resources (not shown - see CAM connector examples)
# resource "visionone_cam_connector_azure" "subscriptions" {...}

# Cleanup legacy App Registration (only if not reusing)
resource "visionone_cam_legacy_cleanup_app_registration" "primary" {
  count = var.use_existing_app_registration ? 0 : 1

  depends_on = [visionone_cam_connector_azure.subscriptions]

  subscription_id = var.primary_subscription_id
}

# Output cleanup results
output "app_registration_cleanup_summary" {
  value = var.use_existing_app_registration ? null : {
    deleted = try(
      visionone_cam_legacy_cleanup_app_registration.primary[0].deleted,
      false
    )
    service_principal_deleted = try(
      visionone_cam_legacy_cleanup_app_registration.primary[0].service_principal_deleted,
      false
    )
    federated_identity_deleted = try(
      visionone_cam_legacy_cleanup_app_registration.primary[0].federated_identity_deleted,
      false
    )
    cleanup_status = try(
      visionone_cam_legacy_cleanup_app_registration.primary[0].cleanup_status,
      "skipped"
    )
  }
}
```

</details>

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `subscription_id` (String) Azure subscription ID containing the legacy App Registration to delete

### Optional

- `app_registration_object_id` (String) Object ID of the App Registration for validation (optional). If provided, cleanup will fail if the detected App Registration doesn't match this ID.

### Read-Only

- `cleanup_error` (String) Error message if cleanup failed
- `cleanup_status` (String) Status of cleanup operation: deleted, not_found, or failed
- `deleted` (Boolean) Whether the App Registration was successfully deleted
- `deletion_timestamp` (String) Timestamp when deletion was performed (RFC3339 format)
- `federated_identity_deleted` (Boolean) Whether the Federated Identity was deleted (cascaded from App Registration deletion)
- `id` (String) Unique identifier for this cleanup resource (subscription ID)
- `service_principal_deleted` (Boolean) Whether the Service Principal was deleted (cascaded from App Registration deletion)

## Important Notes

- **Built-In Detection**: Resource automatically detects whether legacy App Registration exists before attempting cleanup
- **Cascading Deletion**: Deleting the App Registration automatically deletes the associated Service Principal and Federated Identity Credentials
- **Primary Subscription Only**: This resource should only be used once for the primary subscription, not for each subscription in a management group
- **Reuse Scenario**: If reusing an existing App Registration for Ver2 deployment, use `count = 0` or don't create this resource
- **Validation**: Use the optional `app_registration_object_id` parameter to validate the correct resource is being deleted
- **Graceful Handling**: If no legacy App Registration exists, `cleanup_status` will be "not_found" (not an error)
- **No Dry Run**: This resource always attempts cleanup when applied (gracefully handles non-existent resources)

## Cleanup Status Values

The `cleanup_status` field indicates what happened:

- **`deleted`** - Legacy App Registration was found and successfully deleted
- **`not_found`** - No legacy App Registration exists (nothing to clean up)
- **`failed`** - Cleanup operation encountered an error (check `cleanup_error` field for details)
- **`recreated`** - Legacy resource was recreated after previous cleanup (detected during refresh)

## Terraform Behavior

### terraform apply
Creates the cleanup resource in Terraform state, detects legacy App Registration, and deletes it if found.

### terraform destroy
Removes the cleanup resource from Terraform state. **Does NOT delete** the Azure App Registration (cleanup only happens on apply, not destroy).

### terraform refresh
Re-checks if the App Registration was recreated after cleanup. Updates `cleanup_status` to "recreated" if detected.

## Import

Legacy cleanup resources do not support import as they are cleanup operations rather than persistent Azure resources.
